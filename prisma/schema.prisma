generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Chemical {
  id             String   @id @default(cuid())
  name           String   @unique
  unit           String   // BARREL, BUCKET, or BOX
  increment      Float
  trackOnShelf   Boolean  @default(true)
  trackOnLine    Boolean  @default(false)
  gallonsPerUnit Float?
  active         Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  inventory       InventoryState?
  activityLogs    ActivityLog[]
  requestItems    RequestItem[]
}

model InventoryState {
  chemicalId String   @id
  shelfQty   Float    @default(0)
  lineQty    Float    @default(0)
  updatedAt  DateTime @updatedAt

  chemical   Chemical @relation(fields: [chemicalId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id         String   @id @default(cuid())
  type       String   // PICKUP, REQUEST, or UPDATE
  chemicalId String
  location   String?  // SHELF or LINE
  setQty     Float?
  addQty     Float?
  requestQty Float?
  note       String?
  createdBy  String?
  createdAt  DateTime @default(now())
  batchId    String?  // Groups related logs from same transaction

  chemical   Chemical   @relation(fields: [chemicalId], references: [id], onDelete: Cascade)

  @@index([type, createdAt])
  @@index([chemicalId, createdAt])
  @@index([batchId, createdAt])
}

model RequestBatch {
  id          String        @id @default(cuid())
  status      String        @default("OPEN") // OPEN or FULFILLED
  note        String?
  createdBy   String?
  createdAt   DateTime      @default(now())
  fulfilledAt DateTime?
  items       RequestItem[]

  @@index([status, createdAt])
}

model RequestItem {
  id           String       @id @default(cuid())
  batchId      String
  chemicalId   String
  requestedQty Float
  pickedUpQty  Float?       @default(0)

  batch        RequestBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  chemical     Chemical     @relation(fields: [chemicalId], references: [id], onDelete: Cascade)

  @@index([batchId])
  @@index([chemicalId])
}

model UsageHistory {
  id              String   @id @default(cuid())
  chemicalId      String
  chemicalName    String   // Denormalized for historical tracking
  eventType       String   // PICKUP or USAGE
  quantityGallons Float    // Always stored in gallons for consistency
  quantityUnits   Float    // Original units (barrels, buckets, boxes)
  unit            String   // BARREL, BUCKET, BOX
  location        String?  // SHELF or LINE
  costPerUnit     Float?   // Cost per unit at time of pickup (for future cost tracking)
  totalCost       Float?   // Total cost of this transaction
  note            String?
  recordedAt      DateTime @default(now())

  @@index([chemicalId, recordedAt])
  @@index([eventType, recordedAt])
  @@index([recordedAt])
}

model MaintenanceTask {
  id          String    @id @default(cuid())
  description String
  status      String    @default("OPEN") // OPEN or COMPLETED
  urgent      Boolean   @default(false)
  note        String?
  createdAt   DateTime  @default(now())
  completedAt DateTime?

  @@index([status, createdAt])
}

model RepairLog {
  id          String    @id @default(cuid())
  description String
  date        DateTime
  cost        Float?
  note        String?
  createdBy   String?
  createdAt   DateTime  @default(now())

  @@index([date])
}

model PartsReceived {
  id          String    @id @default(cuid())
  description String
  quantity    Float?
  unit        String?
  date        DateTime
  cost        Float?
  note        String?
  createdBy   String?
  createdAt   DateTime  @default(now())

  @@index([date])
}

